{% extends 'layout.html' %}

{% block content %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>
        $(function () {

            // We use an inline data source in the example, usually data would
            // be fetched from a server

            var data = [],
                totalPoints = 300;

            function getRandomData() {

                if (data.length > 0)
                    data = data.slice(1);

                // Do a random walk

                while (data.length < totalPoints) {


                    var prev = data.length > 0 ? data[data.length - 1] : 50,
                        y = prev + Math.random() * 10 - 5;

                    if (y < 0) {
                        y = 0;
                    } else if (y > 100) {
                        y = 100;
                    }

                    data.push(y);
                }

                // Zip the generated y values with the x values

                var res = [];
                for (var i = 0; i < data.length; ++i) {
                    res.push([i, data[i]])
                }

                return res;
            }

            function getWLMdata() {
                var res = [];
                data = [Math.random(), Math.random(), Math.random(), Math.random(), Math.random(), Math.random()];
                for (var i = 0; i < data.length; ++i) {
                    res.push([i, data[i]])
                }

                return res;
            }

            // Set up the control widget

            var updateInterval = 100;
            $("#updateInterval").val(updateInterval).change(function () {
                var v = $(this).val();
                if (v && !isNaN(+v)) {
                    updateInterval = +v;
                    if (updateInterval < 1) {
                        updateInterval = 1;
                    } else if (updateInterval > 2000) {
                        updateInterval = 2000;
                    }
                    $(this).val("" + updateInterval);
                }
            });

            var plot = $.plot("#graph", [getRandomData()], {
                {#            var plot = $.plot("#graph", [getWLMdata()], {#}
                series: {
                    shadowSize: 0	// Drawing is faster without shadows
                },
                yaxis: {
                    min: 0,
                    max: 100
                },
                xaxis: {
                    show: false
                }
            });

            function update() {

                plot.setData([getRandomData(), getWLMdata(), getRandomData()]);

                // Since the axes don't change, we don't need to call plot.setupGrid()

                plot.draw();
                setTimeout(update, updateInterval);
                $("#chan1").text((Math.random() + 384.230406373).toFixed(5) + " THz")
                $("#chan2").text((Math.random() + 384.230406373).toFixed(5) + " THz")
                $("#chan3").text((Math.random() + 384.230406373).toFixed(5) + " THz")
                $("#chan4").text((Math.random() + 384.230406373).toFixed(5) + " THz")
                $("#chan5").text((Math.random() + 384.230406373).toFixed(5) + " THz")
                $("#chan6").text((Math.random() + 384.230406373).toFixed(5) + " THz")
                $("#chan7").text((Math.random() + 384.230406373).toFixed(5) + " THz")
                $("#chan8").text((Math.random() + 384.230406373).toFixed(5) + " THz")

            }

            update();

            // Add the Flot version string to the footer

            $("#footer").prepend("Flot " + $.plot.version + " &ndash; ");
        });
    </script>

    <style>
        #graph {
            width: 100%;
            height: 200px
        }
    </style>
    <script type=text/javascript>
        $(function () {
            $('a#calculate').bind('click', function () {
                $.getJSON($SCRIPT_ROOT + '/_pollWLM', {}, function (data) {
                    $("#result").text(data.result);

                });
                return false;
            });
        });

        (function worker() {
            $.ajax({
                url: '/_pollWLM',
                success: function (data) {
                    $('#result').text(data.result);
                    $("#result").text(data.result);
                },
                complete: function () {
                    // Schedule the next request when the current one's complete
                    setTimeout(worker, 500);
                }
            });
        })();
        $(".ChanToggleButton").click(function () {
            $(this).button('toggle');
        });

    </script>
    <p><span id=result>?</span>
    <p><a href=# id=calculate>poll WLM</a>


    <div class="container-fluid" id="freqIndicator">
        <div class="row">
            <div class="col-lg-12 chanfreq" id="chan1">348.2123 Thz</div>
        </div>
        <div class="row">
            <div class="col-lg-6 chanfreq" id="chan2">348.2123 Thz</div>
            <div class="col-lg-6 chanfreq" id="chan3">2123123</div>
        </div>
        <div class="row">
            <div class="col-lg-6 chanfreq" id="chan4">348.2123 Thz</div>
            <div class="col-lg-6 chanfreq" id="chan5">2123123</div>
        </div>
        <div class="row">
            <div class="col-lg-6 chanfreq" id="chan6">348.2123 Thz</div>
            <div class="col-lg-6 chanfreq" id="chan7">348.2123 Thz</div>
        </div>
        <div class="row">
            <div class="col-lg-12 chanfreq" id="chan8">348.2123 Thz</div>
        </div>
    </div>
    <div class="btn-group">
        <label>MASTER channel 1:
            <input type="checkbox" checked data-toggle="toggle">
        </label>
    </div>
    <div>
        <div class="btn-group">
            <label>MOT COOLING channel 2:
                <input id="chan2toggle" type="checkbox" checked data-toggle="toggle">
            </label>
            <div id="chan2state"></div>
        </div>
    </div>
    <label>MOT REPUMP channel 3:
        <input type="checkbox" checked data-toggle="toggle">
    </label>
    <label>COLD EXP PROBE channel 4:
        <input type="checkbox" checked data-toggle="toggle">
    </label>
    <label>TI SAPH channel 8:
        <input type="checkbox" checked data-toggle="toggle">
    </label>

    <div id="graph"></div>

    <script>
        $(function () {
            $('#chan2toggle').change(function () {
                $('#chan2state').html('Toggle: ' + $(this).prop('checked'))
                $('#chan2').text('this')

            })
            $("#freqIndicator").css({fontSize: 50})
            $("#freqIndicator").css('text-align', 'center')
            $("#freqIndicator").css('background', 'gray')
            $(".chanfreq").css('border-style', 'solid')
        })
    </script>



{% endblock %}